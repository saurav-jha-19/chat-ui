<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Product Chat</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #ece5dd;
}

/* HEADER */
.header {
  display: flex;
  align-items: center;
  padding: 10px;
  background: #075e54;
  color: white;
}
.header img {
  width: 42px;
  height: 42px;
  border-radius: 50%;
  margin-right: 10px;
  object-fit: cover;
  background: #ccc;
}
.header .info {
  display: flex;
  flex-direction: column;
}
.header .name {
  font-weight: bold;
  font-size: 16px;
}
.header .status {
  font-size: 12px;
  opacity: 0.8;
}

/* CHAT */
.chat {
  padding: 15px;
  height: calc(100vh - 120px);
  overflow-y: auto;
}

/* MESSAGE */
.msg {
  max-width: 70%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 8px;
  font-size: 14px;
  line-height: 1.4;
  clear: both;
}
.left { background: #fff; float: left; }
.right { background: #dcf8c6; float: right; }

/* INPUT */
.input-box {
  display: flex;
  padding: 10px;
  background: #f0f0f0;
}
.input-box input {
  flex: 1;
  padding: 10px;
  border-radius: 20px;
  border: none;
  outline: none;
}
.input-box button {
  margin-left: 10px;
  padding: 10px 15px;
  border: none;
  background: #25d366;
  color: white;
  border-radius: 50%;
  cursor: pointer;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <img id="profilePic" src="https://via.placeholder.com/100">
  <div class="info">
    <div class="name" id="profileName">Loading...</div>
    <div class="status">online</div>
  </div>
</div>

<!-- CHAT -->
<div class="chat" id="chatBox">
  <div class="msg left">Namaste üôè kaise madad kar sakta hoon?</div>
</div>

<!-- INPUT -->
<div class="input-box">
  <input id="msgInput" placeholder="Type a message..." />
  <button onclick="sendMsg()">‚û§</button>
</div>

<script>
// ===============================
// STEP 1: GET HANDLE FROM URL
// ===============================
const params = new URLSearchParams(window.location.search);
const handle = params.get("handle");

if (!handle) {
  document.getElementById("profileName").innerText = "No product selected";
  throw new Error("Product handle missing");
}

// ===============================
// STEP 2: FETCH SHOPIFY PRODUCT
// ===============================
fetch(`https://www.yagnamart.com/products/${handle}.js`)
  .then(res => {
    if (!res.ok) throw new Error("Product not found");
    return res.json();
  })
  .then(product => {

    // Product name
    document.getElementById("profileName").innerText =
      product.title || "Product";

    // Product image (SAFE)
    let imageUrl = "";

    if (product.featured_image) {
      imageUrl = product.featured_image;
    } else if (product.images && product.images.length > 0) {
      imageUrl = product.images[0];
    }

    if (imageUrl) {
      if (imageUrl.startsWith("//")) {
        imageUrl = "https:" + imageUrl;
      }
      document.getElementById("profilePic").src = imageUrl;
    }

  })
  .catch(err => {
    console.error(err);
    document.getElementById("profileName").innerText =
      "Product unavailable";
  });

// ===============================
// STEP 3: LOCAL CHAT DEMO
// ===============================
function sendMsg() {
  const input = document.getElementById("msgInput");
  if (!input.value) return;

  const msg = document.createElement("div");
  msg.className = "msg right";
  msg.innerText = input.value;

  document.getElementById("chatBox").appendChild(msg);
  input.value = "";

  document.getElementById("chatBox").scrollTop =
    document.getElementById("chatBox").scrollHeight;
}
</script>

</body>
</html>
